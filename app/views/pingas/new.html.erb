<div class="map">
  <div style='width: 520px;'>
    <div id="create-pinga-map" style='width: 520px; height: 550px;'></div>
  </div>
</div>

<div class="content">
  <% if @pinga.errors.any? %>
    <p id="invalid-form-ping-coords" hidden><%= {lat: @pinga.latitude, lng: @pinga.longitude }.to_json %></p>

    <% @pinga.errors.full_messages.each do |msg| %>
      <p><%= msg %></p>
    <% end %>

  <% else %>
    <p id="user-coords" hidden><%= {lat: @user.latitude, lng: @user.longitude }.to_json %></p>
  <% end %>

  <h2>create a new pingit</h2>
  <div id="form">
    <%= render partial: "form" %>
    <ul id="errors"></ul>
  </div>
</div>
<script>
  // create-pingas.js
  var placeSearch, autocomplete, geocoder;

  function initialize() {
    
    var map_style = [{featureType:"water",elementType:"geometry",stylers:[{color:"#a2daf2"}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{color:"#f7f1df"}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#d0e3b4"}]},{featureType:"landscape.natural.terrain",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#bde6ab"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.medical",elementType:"geometry",stylers:[{color:"#fbd3da"}]},{featureType:"poi.business",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#ffe15f"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#efd151"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{color:"black"}]},{featureType:"transit.station.airport",elementType:"geometry.fill",stylers:[{color:"#cfb2db"}]}]

    // want map to center on user at first
    var mapOptions = {
      zoom: 17,
      center: new google.maps.LatLng(41.8899109, -87.6376566), // this needs to be the user's location, or the location of the last pinga in an incorrectly submitted form
      styles: map_style
    };

    var map = new google.maps.Map(document.getElementById('create-pinga-map'),
        mapOptions);

    var geocoder = new google.maps.Geocoder();

    var userMarker = new google.maps.Marker({
      position: map.getCenter(), // this should be the user's location
      map: map,
      title: 'Your current location',
      draggable: true
    });

    google.maps.event.addListener(userMarker, 'dragend', function() {
      var latLng = userMarker.getPosition();
      geocoder.geocode({'latLng': latLng}, function(results, status) {
        $('#autocomplete').val(results[0].formatted_address);
      });
    });

    autocomplete = new google.maps.places.Autocomplete(
      (document.getElementById('autocomplete')),
      { types: ['geocode'] }
    );

    google.maps.event.addListener(autocomplete, 'place_changed', function() {
      var place = autocomplete.getPlace();
      map.panTo(place.geometry.location);
      map.setZoom(17);
      userMarker.setPosition(place.geometry.location);
      userMarker.setVisible(true);
    });

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        var geolocation = new google.maps.LatLng(
            position.coords.latitude, position.coords.longitude);
        autocomplete.setBounds(new google.maps.LatLngBounds(geolocation,
            geolocation));
      });
    };

    google.maps.event.addListener(userMarker, 'click', function() {
      map.setZoom(18);
      map.setCenter(userMarker.getPosition());
    });
  }

  google.maps.event.addDomListener(window, 'load', initialize);

  $(document).ready(function(){
    var today = new Date();
    var currentHour = today.getHours();
    var todaysLastHour = currentHour - 12

    $('#pinga_start_time').on('change', function() {
      var time = parseFloat($('#pinga_start_time').val());
      console.log(time);
      var currentHour = (new Date()).getHours();
      // selectedHour = parseFloat($('#date_hour').val());
      // if(selectedHour <= todaysLastHour) {
      //   $('#which_day').text("tomorrow");
      // } else {
      //   $('#which_day').text("today");
      // }
    });
  });
</script>